import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as l}from"./app-CHBNztBQ.js";const h="/img/%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%AE%8C%E6%88%90.png",e="/img/%E8%A7%86%E9%A2%91%E5%88%87%E7%89%87%E5%AE%8C%E6%88%90.png",t="/img/demo%E7%9B%AE%E5%BD%95.png",p={};function k(r,i){return l(),a("div",null,i[0]||(i[0]=[n(`<h2 id="_1-dash简介" tabindex="-1"><a class="header-anchor" href="#_1-dash简介"><span>1. Dash简介</span></a></h2><p><strong>Dynamic Adaptation Streaming over HTTP (Dash):</strong> HTTP上的动态自适应视频流技术，它将一个视频划分为许多个segment，每个segment有不同质量的副本，能够在播放时根据用户当前的网络状况选择最佳的码率，减少卡顿。详情: <a href="https://dashif.org/" target="_blank" rel="noopener noreferrer">https://dashif.org/</a></p><h2 id="_2-配置环境" tabindex="-1"><a class="header-anchor" href="#_2-配置环境"><span>2. 配置环境</span></a></h2><ul><li>环境 <ul><li>系统：Windows 10</li><li>客户端：Chrome</li></ul></li><li>工具 (安装好并将<code>bin</code>目录加入系统环境变量) <ul><li>服务器：Nginx <a href="https://www.cnblogs.com/taiyonghai/p/9402734.html" target="_blank" rel="noopener noreferrer">安装教程</a></li><li>编解码器：<a href="https://github.com/BtbN/FFmpeg-Builds/releases" target="_blank" rel="noopener noreferrer">FFmpeg</a></li><li>视频切片工具：<a href="https://www.bento4.com/downloads/" target="_blank" rel="noopener noreferrer">Bento4</a></li><li>播放器：<a href="https://github.com/Dash-Industry-Forum/dash.js" target="_blank" rel="noopener noreferrer">dash.js</a></li></ul></li><li>视频 <ul><li>Big Buck Bunny 可以去 <a href="https://download.blender.org/peach/bigbuckbunny_movies/" target="_blank" rel="noopener noreferrer">https://download.blender.org/peach/bigbuckbunny_movies/</a> 下载</li></ul></li></ul><h2 id="_3-对视频进行编码" tabindex="-1"><a class="header-anchor" href="#_3-对视频进行编码"><span>3. 对视频进行编码</span></a></h2><ul><li>目标编码格式：H.264/AVC</li><li>目标分辨率级别： <ul><li>1920×1080 (1080p)</li><li>1280×720 (720p)</li><li>854×480 (480p)</li><li>640×360 (360p)</li><li>256×144 (144p)</li></ul></li><li>编码命令：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ffmpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Big_Buck_Bunny_1080p.avi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1920x1080</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c:v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyint_min</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sc_threshold</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_1920x1080.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ffmpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Big_Buck_Bunny_1080p.avi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1280x720</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c:v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyint_min</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sc_threshold</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_1280x720.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ffmpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Big_Buck_Bunny_1080p.avi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 896x504</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c:v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyint_min</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sc_threshold</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_896x504.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ffmpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Big_Buck_Bunny_1080p.avi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 640x360</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c:v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyint_min</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sc_threshold</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_640x360.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ffmpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Big_Buck_Bunny_1080p.avi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 256x144</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c:v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -keyint_min</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 48</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sc_threshold</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -an</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_256x144.mp4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>-i</code>：输入文件名</li><li><code>-s</code>：输出的分辨率</li><li><code>-c:v libx264</code>：将视频编码为H.264/AVC格式</li><li><code>-keyint_min 48 -g 48 -sc_threshold 0</code>：固定GOP长度为48帧(即2s，具体由帧率决定)。这里如果没有这个参数后面bento4切分时会报错，具体原因见 <a href="https://blog.csdn.net/LvGreat/article/details/103540007" target="_blank" rel="noopener noreferrer">FFmpeg的GOP（I帧）对齐问题</a></li><li><code>-an</code>：不对音频进行编码，dash中音视频分开编码</li><li>最后是输出文件名</li></ul></li></ul><p>可以写个bat，扔那边慢慢跑，视频小的话几十秒就好了。完成后：</p><p><img src="`+h+`" alt="视频编码完成" loading="lazy"> ​</p><h2 id="_4-视频切片" tabindex="-1"><a class="header-anchor" href="#_4-视频切片"><span>4. 视频切片</span></a></h2><ol><li>使用bento4的<code>mp4fragment</code>对视频进行fragment</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4fragment</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --fragment-duration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_1920x1080.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_1080p.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4fragment</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --fragment-duration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_1280x720.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_720p.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4fragment</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --fragment-duration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_896x504.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_480p.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4fragment</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --fragment-duration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_640x360.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_360p.mp4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4fragment</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --fragment-duration</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BBB_256x144.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_144p.mp4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>--fragment-duration</code>：指定fragment时长为2s</p><ol start="2"><li><p>使用<code>mp4dash</code>对已fragment的视频进行切片</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mp4dash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_1080p.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_720p.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_480p.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_360p.mp4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fragmented_144p.mp4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>成后目录中会自动生成out文件夹，里面有mpd文件和切分的segment</p><figure><img src="`+e+'" alt="视频切片完成" tabindex="0" loading="lazy"><figcaption>视频切片完成</figcaption></figure></li></ol><h2 id="_5-编写简易网页播放器" tabindex="-1"><a class="header-anchor" href="#_5-编写简易网页播放器"><span>5. 编写简易网页播放器</span></a></h2><p>参考：<a href="https://github.com/Dash-Industry-Forum/dash.js%E2%80%8B" target="_blank" rel="noopener noreferrer">https://github.com/Dash-Industry-Forum/dash.js​</a></p><p>将out里面的video文件夹和<code>stream.mpd</code>放到nginx的html文件夹里，下载<code>dash.all.min.js</code>也放入html文件夹中。</p><p>具体的目录结构可以自定义。我这边的目录如下：</p><figure><img src="'+t+`" alt="demo目录" tabindex="0" loading="lazy"><figcaption>demo目录</figcaption></figure><p>DashJS.html代码如下：</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;!</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">doctype</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Dash.js Rocks&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">title</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            video</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                width: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">640</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">px</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                height: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">360</span><span style="--shiki-light:#986801;--shiki-dark:#E06C75;">px</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">style</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">head</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">video</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;videoPlayer&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> controls</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">video</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;./dash.all.min.js&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> url</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;./stream.mpd&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                var</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> player</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> dashjs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MediaPlayer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">                player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">initialize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">querySelector</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;#videoPlayer&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            })();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><h2 id="_6-配置nginx服务器" tabindex="-1"><a class="header-anchor" href="#_6-配置nginx服务器"><span>6. 配置Nginx服务器</span></a></h2><p>配置访问控制，参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">跨源资源共享（CORS） - HTTP | MDN</a></p><p>修改Nginx的conf下的nginx.conf文件中的server段，主要是加入location /file那一块</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">    listen</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">       8800;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">    server_name</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">    location</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> /</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">        root</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">   html;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">        index</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">  index.html</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    location /file {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">        if</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> ($request_method</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> =</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> &#39;OPTIONS&#39;)</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            add_header</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> Access-Control-Allow-Origin</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> $http_origin;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            add_header</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> Access-Control-Allow-Methods</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             </span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            $http_access_control_request_method;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            add_header</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> Access-Control-Allow-Credentials</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> true;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            add_header</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> Access-Control-Allow-Headers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            $http_access_control_request_method;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            add_header</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> Access-Control-Max-Age</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> 1728000;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">            return</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;"> 204;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    #error_page  </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">              /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">404</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    error_page   </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">x.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    location = /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">x.html {</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">        root</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">   html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证Nginx配置是否正确，正确后启动Nginx</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-验证" tabindex="-1"><a class="header-anchor" href="#_7-验证"><span>7. 验证</span></a></h2><p>最后打开 <a href="http://localhost:8800/DashDemo/DashJS.html" target="_blank" rel="noopener noreferrer">http://localhost:8800/DashDemo/DashJS.html</a> 验证是否成功即可</p><p>​</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li>[1] <a href="https://codeleading.com/article/26092631381/#5_Bento4_90" target="_blank" rel="noopener noreferrer">DSAH视频系统（服务器&amp;播放器）搭建 - 代码先锋网</a></li><li>[2] <a href="https://blog.csdn.net/OCTODOG/article/details/79007302" target="_blank" rel="noopener noreferrer">Nginx 搭建DASH服务器_山城过雨的博客-CSDN博客</a></li><li>[3] <a href="https://www.instructables.com/Making-Your-Own-Simple-DASH-MPEG-Server-Windows-10/" target="_blank" rel="noopener noreferrer">Making Your Own Simple MPEG-DASH Server (Windows 10) : 12 Steps - Instructables</a></li></ul>`,32)]))}const F=s(p,[["render",k]]),c=JSON.parse('{"path":"/life/windows-dash.html","title":"Windows平台搭建Dash系统","lang":"zh-CN","frontmatter":{"title":"Windows平台搭建Dash系统","date":"2020-12-01T00:00:00.000Z","category":["工具"],"tag":["视频流"],"excerpt":"Windows平台上搭建Dash自适应视频流系统的流程","description":"1. Dash简介 Dynamic Adaptation Streaming over HTTP (Dash): HTTP上的动态自适应视频流技术，它将一个视频划分为许多个segment，每个segment有不同质量的副本，能够在播放时根据用户当前的网络状况选择最佳的码率，减少卡顿。详情: https://dashif.org/ 2. 配置环境 环境 ...","head":[["meta",{"property":"og:url","content":"https://xchanper.github.io/life/windows-dash.html"}],["meta",{"property":"og:site_name","content":"chanper"}],["meta",{"property":"og:title","content":"Windows平台搭建Dash系统"}],["meta",{"property":"og:description","content":"1. Dash简介 Dynamic Adaptation Streaming over HTTP (Dash): HTTP上的动态自适应视频流技术，它将一个视频划分为许多个segment，每个segment有不同质量的副本，能够在播放时根据用户当前的网络状况选择最佳的码率，减少卡顿。详情: https://dashif.org/ 2. 配置环境 环境 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://xchanper.github.io/img/%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%AE%8C%E6%88%90.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-22T07:34:10.000Z"}],["meta",{"property":"article:tag","content":"视频流"}],["meta",{"property":"article:published_time","content":"2020-12-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-22T07:34:10.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Windows平台搭建Dash系统\\",\\"image\\":[\\"https://xchanper.github.io/img/%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81%E5%AE%8C%E6%88%90.png\\",\\"https://xchanper.github.io/img/%E8%A7%86%E9%A2%91%E5%88%87%E7%89%87%E5%AE%8C%E6%88%90.png\\",\\"https://xchanper.github.io/img/demo%E7%9B%AE%E5%BD%95.png\\"],\\"datePublished\\":\\"2020-12-01T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-22T07:34:10.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"1. Dash简介","slug":"_1-dash简介","link":"#_1-dash简介","children":[]},{"level":2,"title":"2. 配置环境","slug":"_2-配置环境","link":"#_2-配置环境","children":[]},{"level":2,"title":"3. 对视频进行编码","slug":"_3-对视频进行编码","link":"#_3-对视频进行编码","children":[]},{"level":2,"title":"4. 视频切片","slug":"_4-视频切片","link":"#_4-视频切片","children":[]},{"level":2,"title":"5. 编写简易网页播放器","slug":"_5-编写简易网页播放器","link":"#_5-编写简易网页播放器","children":[]},{"level":2,"title":"6. 配置Nginx服务器","slug":"_6-配置nginx服务器","link":"#_6-配置nginx服务器","children":[]},{"level":2,"title":"7. 验证","slug":"_7-验证","link":"#_7-验证","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"git":{"createdTime":1750577650000,"updatedTime":1750577650000,"contributors":[{"name":"chanper","email":"qianchaosolo@gmail.com","commits":1}]},"filePathRelative":"life/windows-dash.md","localizedDate":"2020年12月1日","autoDesc":true}');export{F as comp,c as data};
